pipeline{
    agent any
    tools{
        maven "maven3.8.4"
    }
    stages{
        stage('GitClone'){
            steps{
                git "https://github.com/davidayukashu/maven-web-application"
            }
        }
        stage('TestBuild'){
            steps{
                sh "mvn clean package"
            }
        }
        stage('CodeQuality'){
            steps{
                sh "mvn sonar:sonar"
            }
        }
        stage('UpLoadArtifacts'){
            steps{
                sh "mvn deploy"
            }
        }
        stage('Messages'){
            steps{
                sh "echo ci job successful"
            }
        }
        
        stage('Build Docker Image'){
            steps{
                sh "sudo docker build -t ayukdavidashu/maven-web-app:1 ."
                //sh "docker scan mylandmarktech/maven-web-app"
                //sh "docker push mylandmarktech/maven-web-app"
                echo "build image completed"
            }
        }
        stage('enviroment_variable'){
         steps{
            DOCKERHUB_CREDENTIALS=credentials('dockerhubcredentials')
            }
        }
        stage('Login to Dockerhub'){
            steps{
                sh "echo $DOCKERHUB_CREDENTIALS_PSW | sudo docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin"
                echo "login complete"
            }
        }
        stage('Push Image to Dockerhub'){
            steps{
                sh "sudo docker push ayukdavidashu/maven-web-app:1"
                echo "push image complete"
            }
        }
        
    }
}
